os:
  - linux
dist: xenial  # for Python 3.7
language: python
python:
  - "3.6"
  - "3.7"
  - "3.7-dev"
cache: pip
env:
  - PG_VERSION=9.2
  - PG_VERSION=9.3
  - PG_VERSION=9.4
  - PG_VERSION=9.5
  - PG_VERSION=9.6
  - PG_VERSION=10
addons:
  postgresql: "10"
  apt:
    packages:
      - postgresql-10
      - postgresql-client-10
before_install:
  # Copy postgres config for version 10
  - sudo cp /etc/postgresql/{9.6,10}/main/pg_hba.conf
  # Stop any postgres, then start a specific version of postgres to test against
  - sudo service postgresql stop && sudo service postgresql start $PG_VERSION
install:
  - "pip install -e .[testing]"
before_script:
  - psql -c 'create database dictorm;' -U postgres
script:
  # Run tests verbosely, with coverage
  - "green -rvv"
  # Test installation
  - "python setup.py install"
  # Output the current version
  - "python -m dictorm.version"
  # Verify that dictorm can be imported
  - "python -c 'from dictorm import *'"
services:
  - postgresql
after_success:
  # Submit coverage report to coveralls
  - coveralls
  # Run profiler
  - time python ./profiler.py
deploy:
  provider: pypi
  user: rolobio
  on:
    tags: true
  password:
    secure: mi44wOFuj2QK1MEnGb3aQGAM07wg8eSlOnpAc7Tftq0IH8WMClWoOBwcyv7Wa9NWACNY9+S5dhg14eZasoVCo3o7pArpABLh/8oWagwbqQfXwQYTC6b8ghm7tfeMMxEF7ZvFBU3NrcWCrKj7KTdpF9lVcT7urCPSY2m7ADbvhIsToMBC5c5FQLuQFK+wPlraRXhtKBQpmvOB4rPlNyqRCVsMaAKLot7umeCcwYN+wBhE8+wC7u541qmuTWMTMbThSBVWnNTWdjW5DAnY93MS3tKph1GlFKKVy/+2+YAMd6xUteMZHkt0CpMOcqaWsIz9J/zVAlOmJOpVrZUzvTxJH8kHRjfw/cWQuLnKpv6SDITQ1EhA2gZBUf/itIDRiqmv6sP0FEnSaYhBTtk4uEs8yunw6Wr99Unc6O5KNUGKpcyLCV+20mam+Ep0JMYLCizJJDAou7pD9pnKzMhJGyYiGABCFGNVctprpuaG4V/kxAzZBcqeV5ZW1CB6JJjcO5HHyMjFFUgqQmCP8CvYx5iUMtuENbZD80J1rMvQ/WtJ+ZJWN8L3PduOXog5IDq40W1o1a23bK+db4b1fSohGhBcHN8KBjKsYWeWeHlJdqCdBAiAQpyfpNWhPzviGHxkcJdXRD1hiylWeSPdZYQ8BXzyl6akG1M9uBZ3Q7cUkUj35d8=