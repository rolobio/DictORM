os:
    - linux
dist: xenial  # for Python 3.7
language: python
python:
    - "2.7"
    - "3.4"
    - "3.5"
    - "3.6"
    - "3.7"
env:
    - PG_VERSION=9.2
    - PG_VERSION=9.3
    - PG_VERSION=9.4
    - PG_VERSION=9.5
    - PG_VERSION=9.6
before_install:
    # Stop any postgres, then start a specific version of postgres to test against
    - sudo service postgresql stop && sudo service postgresql start $PG_VERSION
install:
    - "pip install -e .[testing]"
before_script:
    - psql -c 'create database dictorm;' -U postgres
script:
    # Run tests verbosely, with coverage
    - "green -rvv"
    # Test installation
    - "python setup.py install"
    #  Verify that dictorm can be imported
    - "python -c 'from dictorm import *'"
services:
    - postgresql
after_success:
    # Submit coverage report to coveralls
    - coveralls
    # Run profiler
    - time python ./profiler.py
deploy:
  provider: pypi
  user: rolobio
  on:
    tags: true
  password:
    secure: l3qUamczpqrBejHBPTuDOGTYtDQeKymhmwa252b8QNZjI3St46j8o+F6cnCTfzLW51U17+83CwKEUqKRGGkZE2iWGy3aflghgSdeDI09d/jnEfQRCPs9SpfK9dntOJkJfPnVPY4VXWsIexgK9CsN7FDaBtqpXZLOIzbAqsERgPiYbH5n1yNj6qh8JaYBiTajyTKbuk2cXLCpgEI0OVyFvVDbLla5HVnxGcEOkCbaizUYwb0FxMCMeH0prDB/jqrI7yFXhplD0yYfoo+HG9ec8BoBvxBjxemZ/zyjEoCljeKjXr4NLDnSCWpbaa89KJoMPMQUV7IffXp9S5TDyJ+QLItoglk/NabbMOuRchlbL31b9UhyDcqCiVpgIAjOKbDWL0TDoUbf6avzafQ2u0K3Ivi+28HXKvWFtF0zFGPwJbWFm3G6PTxynBtWmsBmhAAKNb68hRugOqA72aOcsbNEBlJ6g8A0ULhwrP6y1SOMJl8lS6iA8zG+xWY5BUczvDyS0bt7UUjxxRAuEkRrqcu46kGUgW/PK1nLtEVZi2gHEQv1s/h7Pdp7904wk6ce9hyVf22X9fgSkzYEvnQQP3ukB+IsO0qu51dbYugKfgtJfkSBhLRd8rAi1MfD6x1eCfj/60Ai3E0UGi/HjRKbfI1Il9UmVXfcaUqccSAJwMRYLlA=