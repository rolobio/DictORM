os:
    - linux
dist: trusty
addons:
  apt:
    packages:
      - postgresql-10
      - postgresql-client-10
  postgresql: 10
language: python
python:
    - "2.7"
    - "3.4"
    - "3.5"
    - "3.6"
env:
    - PG_VERSION=9.2
    - PG_VERSION=9.3
    - PG_VERSION=9.4
    - PG_VERSION=9.5
    - PG_VERSION=9.6
    - PG_VERSION=10.0
    - PG_VERSION=10.1
    - PG_VERSION=10.2
    - PG_VERSION=10.3
before_install:
    # Stop any postgres, then start a specific version of postgres to test against
    - sudo service postgresql stop && sudo service postgresql start $PG_VERSION
install:
    - "pip install -e .[testing]"
before_script:
    - psql -c 'create database dictorm;' -U postgres
script:
    # Run tests verbosely, with coverage
    - "green -rvv"
    # Test installation
    - "python setup.py install"
    #  Verify that dictorm can be imported
    - "python -c 'from dictorm import *'"
services:
    - postgresql
after_success:
    # Submit coverage report to coveralls
    - coveralls
    # Run profiler
    - time python ./profiler.py
deploy:
  provider: pypi
  user: rolobio
  password:
    secure: vQdc1p4zDA87PVcr6/vD2lH9hBltJbF+9O0UhTH2EGpMOgB+Fm69YXRnkbBg2La2yQsXDHpNyXCi0SR0vw8+z+ufDMgTux4yTZS5rpnR1lJVuV+p1ANSk9s6Pn6So+3OL2jl45FMwcjb3MDhr1Qx7Ot7VhtI7ZqcCXv3fWGdpaPtfdWBFZA4u7g0jmEswBDAIOnnda7uKJWLaXIshhqt4R5FKNWPidGUuiN0ZPe2n69C3gx9PBqHEuLPCOA74waG4F7d/1bavfe2sOgZJGFtUevyWpuxb53lxQ49VjYKn4li78VonwzgJxJSXt7ABiURHi4osTlCwyhOnvEor+vIb6DEIgUuFCDpqONY9gijh7mMk2jvf87hy2Pi7DQJnap5riJ0KRL3DaXLwEm4k+mjL2nAnXiCjTWgIWjC3+wXQwqrQ1dhhLcYItwgQNRyAkJEQ6lYfLgKzx3wO+TAurb6ET3/aFLBM8x4Xop3fItF/IZdCOSn3BU2I8mWKXcEaZp3REw97+sfJ7XbZ5ni/TXPsqJfWCNyLM2Z23mlwSWfvouGJnN0vRZptlbimTeOtzyidBT3JnvvQ6lyD60QzwrUziQ+4G6jC+ZeQjZh2qy6W8/T/V9loT9xdYjGzJyzXAKE2iyohiyBB4N6ve/zazTmlfgb8klXvUgpNO8X3AT+5IA=
  on:
    tags: true
